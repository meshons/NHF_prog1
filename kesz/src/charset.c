#include "charset.h"

void ascii_2_unicode(char * ascii,unsigned short * uni){
    int i;
    for(i=0;ascii[i] != 0;i++)
        uni[i] = ascii[i];
    uni[i] = 0;
}


void ascii_2_unicode_a(char * ascii,atomic_ushort * uni){
    int i;
    for(i=0;ascii[i] != 0;i++)
        uni[i] = ascii[i];
    uni[i] = 0;
}

void utf8_2_unicode_a(char * utf8,atomic_ushort * uni){
    // https://infoc.eet.bme.hu/karakterkodolas/#4
    int pb, pk;
    pk = 0;
    for (pb = 0; utf8[pb] != 0; ++pb) {
        if (utf8[pb] < 0x80) {
            uni[pk++] = utf8[pb];
        }
        else if (utf8[pb] >> 5 == 6) {
            uni[pk++] = (utf8[pb] & 0x1f) << 6 | (utf8[pb + 1] & 0x3f);
            pb += 1;
        }
        else {
            uni[pk++] = (utf8[pb] & 0x0f) << 12 | (utf8[pb + 1] & 0x3f) << 6 | (utf8[pb + 2] & 0x3f);
            pb += 2;
        }
    }
    uni[pk] = 0x0000;
}

void latin2_2_unicode_a(unsigned char *latin2, atomic_ushort *uni) {
    // https://infoc.eet.bme.hu/karakterkodolas/#4
    // ISO 8859-2 
    atomic_ushort table[128] = {
        0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89,
        0x8A, 0x8B, 0x8C, 0x8D, 0x8E, 0x8F, 0x90, 0x91, 0x92, 0x93,
        0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9A, 0x9B, 0x9C, 0x9D,
        0x9E, 0x9F, 0xA0, 0x104, 0x2D8, 0x141, 0xA4, 0x13D, 0x15A,
        0xA7, 0xA8, 0x160, 0x15E, 0x164, 0x179, 0xAD, 0x17D, 0x17B,
        0xB0, 0x105, 0x2DB, 0x142, 0xB4, 0x13E, 0x15B, 0x2C7, 0xB8,
        0x161, 0x15F, 0x165, 0x17A, 0x2DD, 0x17E, 0x17C, 0x154,
        0xC1, 0xC2, 0x102, 0xC4, 0x139, 0x106, 0xC7, 0x10C, 0xC9,
        0x118, 0xCB, 0x11A, 0xCD, 0xCE, 0x10E, 0x110, 0x143, 0x147,
        0xD3, 0xD4, 0x150, 0xD6, 0xD7, 0x158, 0x16E, 0xDA, 0x170,
        0xDC, 0xDD, 0x162, 0xDF, 0x155, 0xE1, 0xE2, 0x103, 0xE4,
        0x13A, 0x107, 0xE7, 0x10D, 0xE9, 0x119, 0xEB, 0x11B, 0xED,
        0xEE, 0x10F, 0x111, 0x144, 0x148, 0xF3, 0xF4, 0x151, 0xF6,
        0xF7, 0x159, 0x16F, 0xFA, 0x171, 0xFC, 0xFD, 0x163, 0x2D9
    };
 
    int i, j;
    j = 0;
    for (i = 0; latin2[i] != 0; ++i) {
        if (latin2[i] < 128) 
            uni[j++] = latin2[i];
        else
            uni[j++] = table[latin2[i] - 128];
    }
    uni[j] = 0x0000;
}

void win1250_2_unicode_a(unsigned char *win1252,atomic_ushort *uni){
    atomic_ushort table[128] = {
        // forrás a karakterkódokhoz: https://en.wikipedia.org/wiki/Windows-1250
        // részletekben: https://infoc.eet.bme.hu/karakterkodolas/#4
        0x20AC,0x81,0x201A,0x83,0x201E,0x2026,0x2020,0x2021,0x88,0x2030,0x160,0x2039,0x015A,0x164,0x017D,0x179,
        0x90,0x2018,0x2019,0x201C,0x201D,0x2022,0x2013,0x2014,0x98,0x2122,0x161,0x203A,0x015B,0x165,0x017E,0x017A,
        0x00A0,0x02C7,0x02D8,0x141,0x00A4,0x104,0x00A6,0x00A7,0x00A8,0x00A9,0x015E,0x00AB,0x00AC,0x00AD,0x00AE,0x017B,
        0x00B0,0x00B1,0x02DB,0x142,0x00B4,0x00B5,0x00B6,0x00B7,0x00B8,0x105,0x015F,0x00BB,0x013D,0x02DD,0x013E,0x017C,
        0x154,0x00C1,0x00C2,0x102,0x00C4,0x139,0x106,0x00C7,0x010C,0x00C9,0x118,0x00CB,0x011A,0x00CD,0x00CE,0x010E,
        0x110,0x143,0x147,0x00D3,0x00D4,0x150,0x00D6,0x00D7,0x158,0x016E,0x00DA,0x170,0x00DC,0x00DD,0x162,0x00DF,
        0x155,0x0,0x0,0x103,0x0,0x013A,0x107,0x0,0x010D,0x0,0x119,0x00EB,0x011B,0x00ED,0x00EE,0x010F,
        0x111,0x144,0x148,0x00F3,0x00F4,0x151,0x00F6,0x00F7,0x159,0x016F,0x00FA,0x171,0x00FC,0x00FD,0x163,0x02D9        
    };
 
    int i, j;
    j = 0;
    for (i = 0; win1252[i] != 0; ++i) {
        if (win1252[i] < 128)
            uni[j++] = win1252[i];
        else
            uni[j++] = table[win1252[i] - 128];
    }
    uni[j] = 0x0000;
}

void win1252_2_unicode_a(unsigned char *win1252,atomic_ushort *uni){
    atomic_ushort table[128] = {
        //forrás a karakterkódokhoz: https://en.wikipedia.org/wiki/Windows-1252
        // részletekben: https://infoc.eet.bme.hu/karakterkodolas/#4
        0x20AC,0x81,0x201A,0x192,0x201E,0x2026,0x2020,0x2021,0x02C6,0x2030,0x160,0x2039,0x152,0x8D,0x017D,0x8F,
        0x90,0x2018,0x2019,0x201C,0x201D,0x2022,0x2013,0x2014,0x02DC,0x2122,0x161,0x203A,0x153,0x9D,0x017E,0x178,
        0x00A0,0x00A1,0x00A2,0x00A3,0x00A4,0x00A5,0x00A6,0x00A7,0x00A8,0x00A9,0x00AA,0x00AB,0x00AC,0x00AD,0x00AE,0x00AF,
        0x00B0,0x00B1,0x00B2,0x00B3,0x00B4,0x00B5,0x00B6,0x00B7,0x00B8,0x00B9,0x00BA,0x00BB,0x00BC,0x00BD,0x00BE,0x00BF,
        0x00C0,0x00C1,0x00C2,0x00C3,0x00C4,0x00C5,0x00C6,0x00C7,0x00C8,0x00C9,0x00CA,0x00CB,0x00CC,0x00CD,0x00CE,0x00CF,
        0x00D0,0x00D1,0x00D2,0x00D3,0x00D4,0x00D5,0x00D6,0x00D7,0x00D8,0x00D9,0x00DA,0x00DB,0x00DC,0x00DD,0x00DE,0x00DF,
        0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0x00EA,0x00EB,0x00EC,0x00ED,0x00EE,0x00EF,
        0x00F0,0x00F1,0x00F2,0x00F3,0x00F4,0x00F5,0x00F6,0x00F7,0x00F8,0x00F9,0x00FA,0x00FB,0x00FC,0x00FD,0x00FE,0x00FF        
    };
 
    int i, j;
    j = 0;
    for (i = 0; win1252[i] != 0; ++i) {
        if (win1252[i] < 128) 
            uni[j++] = win1252[i];
        else
            uni[j++] = table[win1252[i] - 128];
    }
    uni[j] = 0x0000;
}

void unicode_2_ascii(unsigned short *uni, char *ascii){
    int i;
    for(i=0;uni[i]!=0;i++)
        ascii[i] = uni[i] % 256;
}

void unicode_2_unicode_a(unsigned short *uni_nona,atomic_ushort *uni){
    int i;
    for(i=0;uni_nona[i] != 0;i++)
        uni[i] = uni_nona[i];
}

void char_2_char_a(char * c,atomic_char *ca){
    int i;
    for(i=0;c[i]!=0;i++)
        ca[i] = c[i];
}


bool cmp_a_ushort(atomic_ushort *s1,atomic_ushort *s2){
    int i,j,l;
    for(j=0;s1[j]!=0;j++);
    for(l=0;s2[l]!=0;l++);
    if(j!=l)return false;
    for(i=0;s1[i]==s2[i] && i<j;i++);
    return (j==i);
}

void digit_2_uni(int d,unsigned short *uni){
    //supports only 1000;
    int i=0;
    if(d>=0){
    if(d>=1000)uni[i++]=(d%10000)/1000+'0';
    if(d>=100)uni[i++]=(d%1000)/100+'0';
    if(d>=10)uni[i++]=(d%100)/10+'0';
    if(d>=0)uni[i++]=(d%10)+'0';
    }else{
    d=d*(-1);
    uni[i++] = '-';
    if(d>=1000)uni[i++]=(d%10000)/1000+'0';
    if(d>=100)uni[i++]=(d%1000)/100+'0';
    if(d>=10)uni[i++]=(d%100)/10+'0';
    if(d>=0)uni[i++]=(d%10)+'0';
    }
    uni[i] = 0;
}
